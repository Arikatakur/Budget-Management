<div class="container">
  <h2>Get AI-Powered Financial Suggestions</h2>

  <div>
    <textarea
      [(ngModel)]="userPrompt"
      placeholder="Type your custom question here, or use automatic suggestion."
      rows="4"
      class="form-control"
      >
    </textarea>
  </div>

  <div style="display: flex;align-items: center;justify-content: space-around; ">
    <button (click)="getAutomaticSuggestion()" [disabled]="isLoading">
      {{ isLoading && !isCustom ? 'Generating...' : 'Get Automatic Suggestion' }}
    </button>
    
    <button (click)="getCustomSuggestion()" [disabled]="isLoading || !userPrompt">
      {{ isLoading && isCustom ? 'Generating...' : 'Send Custom Message' }}
    </button>
    
  </div>

  <div *ngIf="isLoading" class="spinner">
    <p>Thinking...</p>
  </div>

  <div *ngIf="error" class="alert alert-danger">
    {{ error }}
  </div>

  <div *ngIf="aiResponse" class="ai-response">
    <h3>AI Assistant's Suggestion:</h3>
    <pre>{{ aiResponse }}</pre>
  </div>

  <div *ngIf="pastSuggestions.length > 0" class="ai-history">
    <h3>Past AI Suggestions</h3>
    <div *ngFor="let suggestion of pastSuggestions; let i = index" class="ai-response" style="margin-bottom: 18px;">
      <div style="display: flex; justify-content: space-between; align-items: center;">
        <div style="flex: 1; text-align: left;">
          <strong>Date:</strong> {{ suggestion.dateGenerated }}
        </div>
        <div style="flex-shrink: 0; text-align: right;">
          <button (click)="toggleExpand(i)">
            {{ expandedIndex === i ? 'Hide' : 'Show' }} Full Response
          </button>
        </div>
      </div>
      <pre [ngStyle]="{ 'margin': '0', 'max-height': expandedIndex === i ? 'none' : '80px', 'overflow': expandedIndex === i ? 'auto' : 'hidden', 'white-space': 'pre-wrap' }">{{ suggestion.response }}</pre>
      <div *ngIf="expandedIndex !== i" style="background: linear-gradient(to bottom, rgba(241,245,249,0) 60%, #f1f5f9 100%); height: 24px; margin-top: -24px;"></div>
    </div>
  </div>
  </div>
