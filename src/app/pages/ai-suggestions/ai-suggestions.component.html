<div class="ai-suggestion-container">
  <h2>Get AI-Powered Financial Suggestions</h2>
  <p>Ask for advice on budgeting, saving, or investment ideas.</p>

  <div class="form-group">
    <textarea
      [(ngModel)]="userPrompt"
      placeholder="Type your custom question here, or use automatic suggestion."
      rows="4"
      class="form-control"
      >
    </textarea>
  </div>

  <div style="display: flex; gap: 10px; margin-bottom: 16px;">
    <button (click)="getAutomaticSuggestion()" [disabled]="isLoading">
      {{ isLoading && !isCustom ? 'Generating...' : 'Get Automatic Suggestion' }}
    </button>
    <button (click)="getCustomSuggestion()" [disabled]="isLoading || !userPrompt">
      {{ isLoading && isCustom ? 'Generating...' : 'Send Custom Message' }}
    </button>
  </div>

  <div *ngIf="isLoading" class="spinner">
    <p>Thinking...</p>
  </div>

  <div *ngIf="error" class="alert alert-danger">
    {{ error }}
  </div>

  <div *ngIf="aiResponse" class="ai-response">
    <h3>AI Assistant's Suggestion:</h3>
    <pre>{{ aiResponse }}</pre>
  </div>

  <div *ngIf="pastSuggestions.length > 0" class="ai-history">
    <h3>Past AI Suggestions</h3>
    <div *ngFor="let suggestion of pastSuggestions; let i = index" class="ai-response" style="margin-bottom: 18px;">
      <div style="font-size: 0.95em; color: #666; margin-bottom: 4px;">
        <strong>Date:</strong> {{ suggestion.dateGenerated }}
      </div>
      <button (click)="toggleExpand(i)" style="margin-bottom: 6px;">
        {{ expandedIndex === i ? 'Hide' : 'Show' }} Full Response
      </button>
      <pre [ngStyle]="{ 'margin': '0', 'max-height': expandedIndex === i ? 'none' : '80px', 'overflow': expandedIndex === i ? 'auto' : 'hidden', 'white-space': 'pre-wrap' }">{{ suggestion.response }}</pre>
      <div *ngIf="expandedIndex !== i" style="background: linear-gradient(to bottom, rgba(241,245,249,0) 60%, #f1f5f9 100%); height: 24px; margin-top: -24px;"></div>
    </div>
  </div>
</div>
